# Playbook

Декларативный способ управления ресурсами.
В поле Playbook#content лежит схема того, каким должен быть результат, в формате JSON.


## Формат схемы

```js
{
  resources: [
    {
      id: 2,
      product_id: 1,
      client_id: 1,
      type: 'cloud_space',
      state: 'deployed',
    },
    {
      id: 3,
      cloud_space_id: 2,
      product_id: 1,
      client_id: 1,
      type: 'machine',
      state: 'deployed',
      memory: 1024,
      vcpus: 1,
      boot_disk_size: 10,
    },
  ],
}
```

Поля `product_id` и `client_id` нужны только при создании ресурса. Если ресурс уже существует, эти поля не учитываются.

Каким образом происходит деплой:
* Эталонная схема сравнивается с текущей ситуацией по ресурсам.
* Получившиеся диффы преобразовываются в набор экшенов.
* Экшены исполняются по порядку.
* Если, чтобы исполнить экшен, нужно подождать, итерация деплоя завершается.
* Если возникает ошибка, статус плейбука обновляется и деплой завершается.
* Если все действия успешно завершились, обновляется статус плейбука и деплой завершается.
